## 初识寄存器

通常是要操作GPIO等外设的电位高低来实现对外部的控制
GPIOx的地址可以在手册上查到，控制电平的是ODR寄存器，有十六位，对应GPIOx的16个引脚，对他操作就行了
可以直接查手册得到GPIOx_ODR的地址，也可以由GPIOx的地址加上ODR的偏移地址得到（地址是32位的）
些C语言程序的时候，由于地址是一个8位的十六进制数，需要将其传化成程序可识别的地址数:

- 1 通过绝对地址
```c
*(unsigned int*)0X40010C0C = 0XFFFF; // *是转化成指针，括号里面是强制类型转换
```
- 2 通过宏定义寄存器名称
```c
#define GPIOB_ODR   (unsigned int*)0X40010C0C
*GPIO_ODR = 0XFFFF
// 也可以把指针*也定义进去
#define GPIOB_ODR   *(unsigned int*)0X40010C0C
GPIO_ODR = 0XFFFF
```
-------------------------------------------------------11.26------------------------------------------------------------------

## 点亮LED的程序

控制GPIO端口需要对三个寄存器进行操作：`GPIOx_ODR`,`GPIOx_CRL`和`时钟RCC`，顺序是`RCC-CRL-ODR`
- 置位，清零可以这样写：
置位：`|=`，清零：`&= ~`
- 操作某一个具体的位可以是`(1<<2)`这种形式，表示1左移2位，就是第二位是一

-------------------------------------------------------11.27------------------------------------------------------------------

## 点亮LED_寄存器映射

使用#define进行宏定义的时候需要将定义的代码放在`.h`的头文件里面，
最好是按照`总线基地址-外设基地址-寄存器地址`累加来写

也可以使用结构体封装形式：
```c
#define GPIOB_BASE (GPIOB的基地址)
typedef unsigned int unit32_t; //这里有分号

typedef struct
{
  unit32_t CRL; // 要根据寄存器的长度来定义
  ;
  ;
  // 寄存器名称
}GPIO_TypeDef; // 这里有分号

#define GPIOB ((GPIO_TypeDef*)GPIOB_BASE)
// #define 想要定义成的名字 ((结构体名字 *)基地址)

// 然后在main函数中引用的时候：
GPIOB -> CRL // 就代表了CRL寄存器的地址
```

- 写一个头文件的时候，为了防止重复调用要封装一下：
```c
#ifndef __NAME_H // NAME是头文件的名称
#define __NAME_H

//文件内容

#endif /* __NAME_H */
```

- tips C语言每当定义一个新变量都要在前面声明该变量的类型

-------------------------------------------------------11.27------------------------------------------------------------------

- tips
声明变量要尽量接近函数体开头的大括号，否则容易出错
固件库编程的时候在前面宏定义各个寄存器和引脚可以提高程序可移植性

-------------------------------------------------------11.28------------------------------------------------------------------

- 在新建一个固件库工程的时候，要在`User`文件夹里面新建一个`bsp`文件夹，在里面新建`_bsp.c` 和`_bsp.h`文件（板级支持包，针对不同开发板）
 - 头文件里面有宏定义和函数声明
 - .c文件里面不要有main函数
- 在keil5里面，要把每个被引用的头文件都添加到路径里面，软件才会在当前工程目录寻找头文件
- 获取变量的指针在前面加`&`

- 为了使可读性增加，可以定义带参数的宏（c语言里面`\`表示续行符，后面紧跟回车）

-------------------------------------------------------11.29------------------------------------------------------------------

GPIO端口的位带操作：
```c
#define BITBAND(addr, bitnum) ((addr & 0xF0000000)+0x02000000+((addr &0x00FFFFFF)<<5)+(bitnum<<2))
// 通用的公式，addr为要操作的寄存器地址，bitnum为要操作的位号

```

-------------------------------------------------------12.1-----------------------------------------------------------------
