# 基础知识

TCP(Transmission Control Protocal) 传输控制协议

它提供了任意长度消息的可靠传输，定义了所有类型数据在网络中的一种健壮传递机制

IP(Internet Protocal) 网际协议

它管理从发送方到接收方的网络传输的路由，并处理于网络和计算机寻址相关的问题


IPV4 32位

IPV6 可以支持128位，目前运营商提供的一般为64位

## ISO/OSI 网络参考模型

ISO/OSI全名 International Organization for Standardization Open Systems Interconnection (国际标准化组织开放系统互连)

前四层为主机层，后三层为介质层

|  数据   | 分层  |
|  :----:  | :----:  |
| 数据  | 应用层 |
| 数据  | 表示层 |
| 数据  | 会话层 |
| 数据段  | 传输层 |
| 分组  | 网络层 |
| 数据帧  | 数据链路层 |
| 比特位 | 物理层 |

一般来说，各层为上一层提供服务，并向下一层交付数据或从下一层接收数据

PDU（Protocal Data Unit，协议数据单元）是在各层传输的数据包

### 1.物理层

物理传输介质（电缆或无线传输介质）

任务是建立、维持和断开网络连接

物理层管理`网络介质`到`协议栈`的通信，发送时将出栈数据转换为网络信号，接收时相反

物理层的数据（PDU）由串行信号组成，对应数据链路层里数据帧的比特位

### 2.数据链路层

任务是确保在`发送方`实现物理层数据的可靠传输，在`接收方`

通过唯一标识每一个网卡的专用地址，识别本地介质上的每个设备

管理网卡之间的`点对点`通信

`介质流控制` 数据链路层能够控制从发送方到接收方数据传输的节奏

### 3.网络层

主要功能是对Internet上的每一个主机提供一个`全球唯一的地址`，并提供主机之间的通信路径

包含DNS（Domain Name System，域名系统）

- 分组交换
- 阻塞控制


### 4.传输层

确保发送方到接收方PUD可靠的端到端传输

在这一层需要进行数据`校验`

数据的`分段`与`重组`：在发送方分段，接收方重组

传输层的PDU称为`数据段`

### 5.会话层

会话层是在发送方和接收方之间进行通信时创建、维持、之后终止或断开连接的地方

通过`检查点`机制来维持可靠会话

### 6.表示层

表示层管理从`网络通用的数据`到`特定机器（或应用程序）`上的数据变换，以及反向变换

`重定向器`（或网络外壳）：将本地资源请求与网络资源请求区分开

### 7.应用层

应用程序用于请求网络程序的`接口`，而不是应用程序本身

应用层定义了应用程序能够从网络上请求的几种类型的`服务`，并且规定了`数据所采用的格式`

## TCP/IP网络模型

是与OSI参考模型对应的另一种模型，它分为4层

### 1.网络访问层

对应物理层+数据链路层

PPP(Point to Point Protocal)点对点协议，用于在两个网络设备之间建立直接的连接

网络访问层（OSI第二层）还包括一些不属于TCP/IP协议族的协议：

- HDLC（High-level Data Link Control) 高速数据链路控制协议
- 帧中继（Frame Raley）
- ATM （Asynchronous Transfer Mode） 异步传输模式


### 2.互联网层

对应网络层

主要有三个基本功能：数据分片、寻址、路由

互联网层的主要协议：

- IP （Internet Protocal） 网际协议：负责把数据包从发送方路由到接收方
- ICMP （Internet Control Message Protocal） Internet控制消息协议
- ARP （Address Resolution Protocal） 地址解析协议：IP地址--MAC地址
- RARP （Reverse Address Resolution Protocal） 反向地址解析协议：MAC地址--IP地址
- BOOTP （Bootstrap Protocal） 自举协议
- RIP （Routing Information Protocal） 路由信息协议：定义了`跳数`（发送方到接收方经过的路由器个数）
- OSFP （Open Shortest Path First） 开放式最短路径优先协议
- BGP （Border Gateway Protocal） 边界网关协议

### 3.传输层

对应传输层

提供了一台主机到另一台主机的数据移动

基本功能包括发送方到接收方的`可靠数据传输`、出站前必要的`消息分段`以及在把数据交给应用层之前`重组分段`

传输层的协议有两个：

- TCP （Transmission Control Protocal） 传输控制协议

`面向连接的`协议，发送数据之前在发送方和接收方之间协商并`维持连接`

- UDP （User Datagram Protocal） 用户数据报协议

`无连接的`协议，以一种“尽最大努力交付”的方式简单地发送数据，在接收方没有任何后续的检验

### 4.应用层

对应会话层+表示层+应用层

协议栈与主机上的应用程序进行交互的地方

TCP/IP服务的运行依赖于两个要素：`守护进程`和`端口地址`


## 套接字

特定`IP地址`+`动态分配端口号`的组合称为套接字地址（Socket Address），简称套接字（Socket）

动态分配端口号指的是`1024~65536`之间的，在需要时为发送方和接收方之间提供有限数据交换的`临时`连接时用到的端口号


# 《计算机网络：自顶向下方法》

## 网络核心

网络核心指的是因特网端系统的分组交换机和链路构成的网状网络

### 分组交换

为了从源端向目的端发送一个报文，源将长报文划分为较小的数据块，称为`分组`

每个分组通过通信链路和`分组交换机`传送。分组交换机主要有两类：`路由器`和`链路层交换机`

#### 1.存储转发传输

存储转发传输指的是交换机必须等待整个分组`全接收完`才能开始发送

#### 2.排队时延和分组丢失

类似于买东西排队，当数据量大时，数据需要在分组交换机的`输出队列`中进行等待

#### 3.转发表和路由选择协议

类比于问路，数据想要去往目的地，数据包的首部包含了目的地的`IP地址`，通过路由器进行“问路”，但中间的路由器并不知道如何去往最终的目的地，它只是知道经由附近的哪个路由器能够
最终走到目的地（`路由表`），所以它将数据转发给相邻的路由器，由此一步步数据最终能够被发送到目的地


### 电路交换

与分组交换不同，电路交换会为即将到来的数据传输`预留资源`，当数据发送时，不需要等待就可以直接传输

这样带来的弊端就是因为要为其他的数据传输预留资源，所以电路交换的每一个传输都只能使用`一部分的链路传输资源`


### 分组交换网中的时延

有以下几种时延：节点处理实验，排队时延，传输时延和传播时延，加起来是节点总时延

#### 1.处理时延

包括检查分组首部和决定该分组导向何处等

#### 2.排队时延

如果当前传输队列有其他分组正在传输，当前分组就需要等待

#### 3.传输时延

指的是将所有比特推向链路所需要的时间（这部分在节点内部完成）

#### 4.传播时延

从起点到终点需要的时间（在路上）

### 分组交换网中的丢包

丢包与`排队时延`有关，需要先说明一个概念：`流量强度`

- 流量强度

如果a表示分组到达队列的平均速率，R表示传输速率，L表示该分组由L个比特组成

则流量强度等于`La/R`

假如`La/R>1`，则比特到达队列的平均速度将超过传输出去的速度，丢列趋于无限增加，所以设计系统时`流量强度不能大于1`

- 丢包

当流量强度小于1的时候，随着流量强度接近1，排队时延并不趋向无穷大，相反，到达的分组将发现一个满的队列，由于没有地方存放这个分组，路由器将`丢弃`该分组，这就是丢包


### 吞吐量

若令Rs表示服务器与路由器之间的链路速率，Rc表示路由器与客户之间的的链路速率，这一两链路网络的吞吐量就是`min(Rs, Rc)`，就是所有速率中的最小值

而如果存在一条共享链路，其速率为R，假设允许同时存在10个传输，则吞吐量为`min(Rs, Rc, R/10)`，即共享链路的速率会被`平分`


## 因特网的5层协议栈（自顶向下）

### 1.应用层

包括网络应用程序以及它们对应的协议

HTTP、FTP、DNS等

数据为`报文`

### 2.传输层

在`应用程序端点`之间传输应用层报文

TCP、UDP

数据为`报文段`

### 3.网络层

负责将数据分组从一台主机移动到另一台主机

IP协议

数据为`数据报`

### 4.链路层

为了将分组从一个节点移动到下一个节点，网络层必须依靠链路层的服务

在每个节点，网络层将数据报`下传`给链路层，链路层沿着路径将数据报传递给下一个节点，在下一个节点，链路层将数据报`上传`给网络层

数据为`帧`

### 5.物理层

将数据帧中的一个个`比特`从一个节点移动到下一个节点

数据是`比特`

### 封装

在发送端，数据自上而下层层封装，每一层都加上该层特有的信息

在接收端，数据自下而上层层解封，每一层都去掉关于该层的信息
