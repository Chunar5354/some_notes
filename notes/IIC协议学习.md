## 物理层

- 两条总线，SCL（串行时钟线）和SDA（双向串行数据线），上面可以挂载多个主机和多个从机
- 每个连接到总线的设备都有独立的地址（一般7位或者10位），主机利用地址进行不同设备之间的访问
- 总线通过上拉电阻（通常4.7K）接到电源（2-15V）
- 设备空闲时输出高阻态，所有设备都空闲时上拉电阻把总线拉成高电平
- 逻辑1通过输出高阻态来实现，逻辑0通过输出低电平实现
- IIC使用时要将引脚配置成`开漏输出`

## 协议层

- 主机向从机写数据过程：
起始信号->从机地址->读写判断位（0代表写）->从机应答位（每个字节应答一次）->主机发给从机数据->从机应答位->停止位

- 主机向从机读数据过程：
起始信号->从机地址->读写判断位（1代表读）->从机应答位（每个字节应答一次）->从机发给主机数据->主机应答位->停止位

- 复合通讯格式
可以具体操作某一从机内部单元
先写后读，产生两次起始信号，写得是该从机内部某一单元的地址（要读取该单元里面的内容）

## 信号的产生

### 起始与停止

起始信号与停止信号都是主机发出的
- 起始信号S：当SCL线处于高电平时，SDA信号的`下降沿`表示起始位
- 停止信号P：当SCL线处于高电平时，SDA信号的`上升沿`表示停止位

### 数据有效性

SDA线传输数据，SCL线进行数据同步
SDA线在SCL的每一个时钟周期传递`一位`数据
- SCL高电平时SDA的数据有效，高电平表示数据1，低电平表示数据0
- SCL低电平的时候SDA数据无效，通常在SCL低电平的时候进行SDA的数据变换

### 设备读写地址

通常设备的地址是7位的，和后面的读写判断位构成一个字节
设备的读写地址指的是而这组合之后的整个字节
设备地址指的是本来的7位设备地址（写成8位）

### 响应

- 传输数据时主机产生时钟，在第9个时钟周期时数据发送端释放SDA的控制权（发送端变成高阻态），由数据接收端控制SDA线
- 应答时SDA高电平表示非应答信号，SDA低电平表示应答信号

## 树梅派的I2C应用

- 树莓派查看GPIO命令：`gpio readall`

### 环境配置
首先需要开启I2C，通过`sudo raspi-config`进行配置，把I2C端口打开
还需要修改一下配置文件，输入命令`sudo nano /etc/modules`，在文件的末尾加上`snd-bcm2835 i2c-bcm2708 i2c-dev`三行内容
然后可以通过输入`lsmod`来查看以上驱动是否添加
添加成功后，重启`sudo reboot`

### i2c tools
为检查连接到树莓派上I2C设备的地址，需要安装一个I2C工具`i2c tools`，输入`sudo apt-get install i2c-tools`进行安装
将I2C外设和树莓派连接好，然后可以通过命令`sudo i2cdetect -y 1`查看该设备的地址，地址为`0x加上输出的内容`

可以通过i2c tools简单对I2C外设进行读写操作：
`sudo i2cdump -y 1 0x地址`，读取该设备寄存器中的数据
`sudo i2cset  -y 1 i2c设备地址 写入位置地址 写入的内容`，向该外设某一具体单元写入数据
